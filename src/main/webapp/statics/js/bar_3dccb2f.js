define("list:widget/new_header/bar/bar.js",function(e){var a=(e("common:widget/ui/passport/passport.js"),e("common:widget/ui/account_forbidden/account_forbidden.js")),t=e("common:widget/ui/cookie/cookie.js"),n=e("common:widget/ui/dialog/dialog.js");$(function(){function e(){var e=t.get("CLOSE_CITY_TIP");null===e&&$(".city-tip-area").css("display","inline-block"),o(),r(),s(),f.attr("href",f.attr("href")+"?u="+encodeURIComponent(window.location.href)),v.attr("href",v.attr("href")+"&u="+encodeURIComponent(window.location.href))}function o(){A?($("body").on({touchstart:function(){this._isMove=!1},touchmove:function(){this._isMove=!0},touchend:function(e){this._isMove||setTimeout(function(){y.ucAreaBodyClickHandler(e)},200)}}),l.on({click:y.ucAreaPadClickHandler})):(c.on({mouseenter:y.ucAreaEnterHandler,mouseleave:y.ucAreaLeaveHandler}),d.on({mouseenter:y.cityDropEnterHandler,mouseleave:y.cityDropLeaveHandler}),u.on({mouseenter:y.noticeAreaEnterHandler,mouseleave:y.noticeAreaLeaveHandler})),g.click(y.closeCityTip),p.click(y.logOutHandler)}function r(){var e=F.context("baid_uss_url");$.ajax(e,{dataType:"jsonp",success:function(){$.getJSON(C,{page:H},y.getUserHandler)},error:function(){$.getJSON(C,{page:H},y.getUserHandler)}})}function s(){var e=F.context("baidu_stoken_url");$.ajax(e,{dataType:"jsonp",jsonpCallback:"cb",success:function(){},error:function(){}})}var i=$("#j-ucLoginList"),c=$("#j-ucArea"),d=$("#j-cityDrop"),u=$("#j-noticeArea"),l=$("#j-uc-link-wrap"),f=$("#j-barLoginBtn"),p=$("#j-logout"),v=$("#j-barRegBtn"),h=$("#j-welcomeTag"),m=$("#j-ucOrderStatus"),g=$("#j-bubble-close"),C="/pclogin/main/userinfo",j="/uc/order/orderstatuscount",_=navigator.userAgent.toLowerCase(),A=_.match(/iPad/i)?!0:!1,H=F.context("page_name"),S=F.context("nuomi_base"),y={closeCityTip:function(){t.set("CLOSE_CITY_TIP","1","week"),$(".city-tip-area").css("display","none")},ucAreaEnterHandler:function(){$(this).addClass("hover")},ucAreaLeaveHandler:function(){$(this).removeClass("hover")},noticeAreaEnterHandler:function(){$(this).addClass("hover")},noticeAreaLeaveHandler:function(){$(this).removeClass("hover")},cityDropEnterHandler:function(){$(this).addClass("active-city")},cityDropLeaveHandler:function(){$(this).removeClass("active-city")},ucAreaPadClickHandler:function(e){$(this).toggleClass("clicked");var a=$(this).hasClass("clicked");a?(c.addClass("hover"),e.preventDefault()):(c.removeClass("hover"),e.preventDefault())},ucAreaBodyClickHandler:function(e){$(e.target).parents("#j-ucArea").length||(l.hasClass("clicked")&&l.removeClass("clicked"),c.removeClass("hover"))},getUserHandler:function(e){if(0==e.errno&&e.data.userInfo)if(i.addClass("has-login"),2==e.data.userInfo.status)a.init();else{var o="Hi，";o+=e.data.userInfo.passUname?decodeURIComponent(e.data.userInfo.passUname):e.data.userInfo.passPhone?e.data.userInfo.passPhone.replace(/^(\d{3}).*(\d{4})$/g,"$1****$2"):e.data.userInfo.passEmail,h.html(o);var r=t.get("BAINUO_ORDER_STATUS_CLOSE");(!r||r.indexOf("a")<0)&&($.getJSON(j,y.getOrderStatusHandler),m.find("a").on("click",y.ucOrderStatusItemClickHandler))}else{var s=e.errno,c=e.data,d=c.baiduUserInfo,u=c.otherBaiduUserInfo,l=c.nuomiUserInfo,f="";d&&(f=d.passUname?d.passUname:d.passEmail?d.passEmail:d.passPhone?d.passPhone:"");var p="";u&&(p=u.passUname?u.passUname:u.passEmail?u.passEmail:u.passPhone?u.passPhone:"");var v="";if(l&&(v=l.email?l.email:l.phone?l.phone:""),9600210==s){f&&(f="（"+f+"）");var g="您的百度帐号已经与其他的糯米账号绑定，下面的糯米账号无法登录。",C=['<div class="ui-passport-tip9600210">','<div class="title">'+g+"</div>",'<div class="text">'+v+"</div>","</div>"],_=600;n.alert({title:"提示",content:C.join(""),width:_}),y.userErrorHandler()}else if(9600208==s){var g="您的糯米账号已与下面的百度账号绑定,请使用该帐号登录！";p||(g="您的糯米账号已与其它的百度账号绑定,请使用该帐号登录！");var C=['<div class="ui-passport-tip9600210">','<div class="title">'+g+"</div>",'<div class="text">'+p+"</div>","</div>"],_=500;n.alert({title:"提示",content:C.join(""),width:_,onok:function(){}}),y.userErrorHandler()}}},getOrderStatusHandler:function(e){if(0==e.errno){for(var a=!1,n=t.get("BAINUO_ORDER_STATUS_CLOSE"),o=["",e.data.soonexpireCount,e.data.uncommentCount,e.data.unpayCount,e.data.merchantReplyCount,e.data.usableHongbaoCount],r="abcdef",s=1;5>=s;s++)(null===n||n.indexOf(r.charAt(s))<0)&&o[s]>0&&(a=!0,m.find("#j-ucStatusLink-"+r.charAt(s)).prev("span").html(o[s]),m.find("#j-ucStatusLink-"+r.charAt(s)).parent().show());a===!0&&m.show()}},ucOrderStatusItemClickHandler:function(e){function a(e){var a=t.get("BAINUO_ORDER_STATUS_CLOSE");t.set("BAINUO_ORDER_STATUS_CLOSE",e+(null===a?"":a),"today")}function n(){if(m.is(":visible")){for(var e=!1,a="abcde",t=1;4>=t;t++)if(m.find("#j-ucStatusLink-"+a.charAt(t)).is(":visible")){e=!0;break}e||m.hide()}}e.target.parentNode.style.display="none",n(),"e"!=e.target.id.charAt(e.target.id.length-1)&&a(e.target.id.charAt(e.target.id.length-1))},logOutHandler:function(){var e=F.context("logout_nuomi");$.ajax(e,{dataType:"json",async:!1,success:function(e){var a=p.attr("href");if(0==e.errno){var t=e.data.BDUSS64;t&&(a+="&sid="+encodeURIComponent(t))}a+="&u="+encodeURIComponent(S),p.attr("href",a)}})},userErrorHandler:function(){var e=F.context("logout_nuomi");$.ajax(e,{dataType:"json",async:!1,success:function(e){var a=F.context("logout_baidu");if(0==e.errno){var t=e.data.BDUSS64;t&&(a+="&sid="+encodeURIComponent(t))}$.ajax(a,{dataType:"jsonp"})}})}};e()})});