/*
 * MTA v1.0.2
 * (c) 2014-2018
 * 美团点评 - 性能平台 
 */
!function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(t){o(e,t,n[t])})}return e}function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=Array.prototype,e=Object.prototype,f=e.hasOwnProperty,n=e.toString,l=function(t){return"function"==typeof t},h=function(t){return"number"==typeof t};function d(t){if("undefined"!=typeof JSON&&l(JSON.stringify))return JSON.stringify(t);switch(a(t)){case"string":return'"'.concat(t,'"');case"boolean":case"number":return String(t);case"object":if(null===t)return"null";var e=!1,n="",i="";for(var r in t)if(f.call(t,r)){i="'".concat(r,"'");var o=d(t[r]);o.length&&(e?n+=",":e=!0,n+=p(t)?o:'"'.concat(i,'":').concat(o))}return p(t)?"[".concat(n,"]"):"{".concat(n,"}");default:return""}}function g(t){if(l(Object.keys))return Object.keys(t);var e=[];for(var n in t)f.call(t,n)&&e.push(n);return e}function p(t){return l(Array.isArray)?Array.isArray(t):"[object Array]"===n.call(t)}function v(t,e,n){if(l(u.map))return t.map(e,n);for(var i=[],r=t.length,o=0;o++<r;)i.push(e.call(n,t[o],o,t));return i}function y(t,n){if(l(u.forEach))t.forEach(function(t,e){n(t,e)});else for(var e=t.length,i=0;i++<e;)n(t[i],i)}function m(t,e,n){if(l(u.filter))return t.filter(e,n);for(var i=[],r=t.length,o=0;o++<r;)e.call(n,t[o],o,t)&&i.push(t[o]);return i}var w={get:function(t){for(var e=document.cookie,n="".concat(t,"="),i=n.length,r=e.length,o=0;o<r;){var a=o+i;if(e.substring(o,a)===n)return u=a,c=s=void 0,s=document.cookie,-1===(c=s.indexOf(";",u))&&(c=s.length),decodeURIComponent(s.substring(u,c));if(0===(o=e.indexOf(" ",o)+1))break}var u,s,c;return""},set:function(t,e,n,i,r,o){r=r||(a=document.domain,"localhost:"===a?"":("undefined"!=typeof M&&M.DOMAIN_HOST&&(a=".".concat(M.DOMAIN_HOST)),"www."===a&&(a=a.substring(0,4)),a));var a;var u=(i?"; path=".concat(i):"")+(r?"; domain=".concat(r):"")+(o?"; secure":"");document.cookie=e?"".concat(t,"=").concat(encodeURIComponent(String(e)))+(n?"; expires=".concat(n):"")+u:"".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT")+(i?"; path=".concat(i):"")+u},getExpire:function(t,e,n){var i=new Date;if(h(t)&&h(e)&&h(n))return i.setDate(i.getDate()+parseInt(t,10)),i.setHours(i.getHours()+parseInt(e,10)),i.setMinutes(i.getMinutes()+parseInt(n,10)),i.toUTCString()}},_={};var b={on:function(t,e){l(e)&&(_[t]||(_[t]=[])).push(e)},emit:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=e.slice(1);if(_[i])for(var o=0;o<_[i].length;o++)_[i][o].apply(this,r)},addEvent:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return window.addEventListener?window.addEventListener(t,e,n):window.attachEvent?window.attachEvent("on".concat(t),e):void 0},removeEvent:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return window.removeEventListener?window.removeEventListener(t,e,n):window.detachEvent?window.detachEvent("on".concat(t),e):void 0}};var k=function(){function e(t){r(this,e),o(this,"_MAX_URL_LENGTH",2083),this.url=t}return t(e,[{key:"config",value:function(t){this.url=t}},{key:"send",value:function(t){d(t).length&&this._post(t)}},{key:"_sendByScript",value:function(t){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="".concat(this.url,"?").concat(t);var n=document.getElementsByTagName("script")[0];n.parentNode&&n.parentNode.insertBefore(e,n)}},{key:"_post",value:function(t){!function(t){if("file:"!==window.location.protocol){var e,n=s({method:"GET",async:!0},t);if(window.XDomainRequest)try{(e=new XMLHttpRequest).open(n.method,n.url),e.send(d(n.data))}catch(t){}else if(window.XMLHttpRequest&&"withCredentials"in(e=new XMLHttpRequest))try{e.open(n.method,n.url,n.async),e.setRequestHeader("Content-Type","text/plain"),e.send(d(n.data))}catch(t){}}}({url:this.url,method:"POST",data:t})}}]),e}(),E=function(){function i(){r(this,i),o(this,"_COOKIE_USER_TRACKING","__mta");var t=window.screen,e=window.navigator,n=this._getViewport();this.screen=t?"".concat(t.width,"x").concat(t.height):"-",this.viewport="".concat(n.width,"x").concat(n.height),this.javaEnabled=e&&e.javaEnabled()?1:0,this.ua=e.userAgent,this.isFirstVisit=!1,this._setCookie()}return t(i,[{key:"getInfo",value:function(){return{sr:this.screen,vp:this.viewport,csz:document.cookie?document.cookie.length:0,ua:this.ua,uuid:this.uuid}}},{key:"_setCookie",value:function(){var t=w.getExpire(720,0,0),e=this._getCurrentTime(),n=w.get(this._COOKIE_USER_TRACKING);if(n){var i=n.split(".");i[2]=i[3],i[3]=String(e),i[4]=String(parseInt(i[4],10)+1),w.set(this._COOKIE_USER_TRACKING,i.join("."),t),this.uuid=i[1]}else{var r=this._hashInfo();n=[r,e,e,e,1].join("."),w.set(this._COOKIE_USER_TRACKING,n,t),this.isFirstVisit=!0,this.uuid=String(r)}}},{key:"_getCurrentTime",value:function(){return(new Date).getTime()}},{key:"_hashInfo",value:function(){for(var t=window,e=t.navigator,n=t.history.length,i=e.appName+e.appVersion+this._getEnvLanguage()+e.platform+e.userAgent+this.javaEnabled+this.screen+(document.cookie?document.cookie:"")+(document.referrer?document.referrer:""),r=i.length;0<n;)i+=n--^r++;return function(t){var e,n=1,i=0;if(t)for(n=0,e=t.length-1;0<=e;e--)n=0!=(i=266338304&(n=(n<<6&268435455)+(i=t.charCodeAt(e))+(i<<14)))?n^i>>21:n;return n}(i)}},{key:"_getViewport",value:function(){var t={width:document.body&&document.body.clientWidth||0,height:document.body&&document.body.clientHeight||0};return null!==window.innerWidth&&(t={width:window.innerWidth,height:window.innerHeight}),"CSS1Compat"===document.compatMode&&(t={width:document.documentElement&&document.documentElement.clientWidth||0,height:document.documentElement&&document.documentElement.clientHeight||0}),t}},{key:"_getEnvLanguage",value:function(){return(navigator&&(navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:"-")).toLowerCase()}}]),i}(),C={activate:"activate",create:"create",config:"config",tag:"tag",timing:"sendTiming",count:"sendCount",gauge:"sendGauge",send:"send",stop:"stop",on:"_on"},O=function(){function u(t){r(this,u),o(this,"_PERF_CATEGORY","fe_perf_web"),o(this,"_SEND_DELAY",100),this.trackerConfig=s({useCombo:!0,sampleRate:100,url:"".concat(location.protocol,"//dreport.meituan.net")},t),this.client=new E,this.beacon=new k(this.trackerConfig.url),this._visitCode=this._random(),this._queue=[],this._tags={}}return t(u,[{key:"create",value:function(t,e){this._app=t,this.trackerConfig=s({},this.trackerConfig,e,{sampleRate:5}),this.send("resources")}},{key:"config",value:function(t,e){if(void 0!==e)switch(t){case"sampleRate":"number"==typeof e&&(this.trackerConfig.sampleRate=e);break;case"useCombo":"boolean"==typeof e&&(this.trackerConfig.useCombo=e);break;case"beaconImage":"string"==typeof e&&-1===e.indexOf("frep.meituan.")&&this.beacon.config(this.trackerConfig.url=e)}}},{key:"tag",value:function(t,e){"string"==typeof t&&t.length&&(void 0!==a(e)?this._tags[t]=e:delete this._tags[t])}},{key:"execute",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)try{var r=e[i];if(l(r))e[i](this);else{var o=(r=[].slice.call(r,0))[0];this[C[o]].apply(this,r.slice(1))}}catch(t){t++}return 0}},{key:"push",value:function(){return this.execute.apply(this,arguments)}},{key:"send",value:function(t,e,n,i){var r=this;if(t&&!(-1<["xhr-dispatch","xhr-result.load","browser.xhr"].indexOf(t)))if("resources"!==t){if(!(e&&e.url&&/catfront|dreport/.test(e.url))){var o=u.plugins[t];o&&(e=o.data(e),i=o.type);var a={};e&&(a[t]=e,this._push(i||"timer",a,n)),this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._timer=window.setTimeout(function(){r._sendData()},this._SEND_DELAY)}}else this._sendResources()}},{key:"sendTiming",value:function(t,e,n){this.send(t,e||1,n,"timer")}},{key:"sendCount",value:function(t,e,n){this.send(t,e||1,n,"counter")}},{key:"sendGauge",value:function(t,e,n){this.send(t,e||1,n,"gauge")}},{key:"activate",value:function(t,e,n){if(this._isSampleHit()&&"fps"===t){var i=this,r=u.plugins.fps;if(r)try{this._fps=r.data(e,n,function(t,e,n){i.sendTiming(t,e,n)}),this._fps.activate()}catch(t){}}}},{key:"stop",value:function(t){this._fps&&"fps"===t&&this._fps.stop()}},{key:"_push",value:function(t,e,n){this._queue.push({type:t,data:e,tags:n||this._tags,ts:String((new Date).valueOf())})}},{key:"_on",value:function(t,e){b.on(t,e)}},{key:"_sendResources",value:function(){if(!(.1<Math.random())){var t=u.plugins.resources;if(t)try{var e=t.data();if(!e)return;for(var n=0;n<e.length;n++){var i=e[n];this.sendTiming("browser.resource",i.data,i.tags)}}catch(t){console.error(t)}}}},{key:"_sendData",value:function(){var n=this;if(this._isSampleHit()){var t=this.trackerConfig.useCombo,e=this.client.getInfo(),i=s({token:this._app,url:location.href,sdkVersion:"1.0.2"},e),r=null,o=[];if(this._queue.length){if(t)1===this._queue.length?o=this._formatLogType(this._queue[0]):y(this._queue,function(t){var e;(e=o).push.apply(e,c(n._formatLogType(t)))}),r=this._formatReportData(i,o),b.emit("data",r),this.beacon.send(r);else for(var a=0;a<this._queue.length;a++)r=this._formatReportData(i,this._formatLogType(this._queue[a])),b.emit("data",r),this.beacon.send(r);this._queue=[]}}}},{key:"_formatLogType",value:function(t){var e=t.data,n=t.tags,i=t.ts,r=g(e)[0],o=g(e[r]),a="browser.ajax"===r,u=m(o,function(t){return"url"!==t&&"method"!==t});return a?m(v(u,function(t){return{ts:i,type:"".concat(r,".").concat(t),value:String(Number(e[r][t])),tags:s({url:e[r].url,method:e[r].method.toUpperCase()},n)}}),function(t){var e=t.type,n=t.value;return!("browser.ajax.error"===e&&"0"===n)}):o.length?v(o,function(t){return{type:"".concat(r,".").concat(t),value:e[r][t],tags:n,ts:i}}):[{type:r,value:e[r],tags:n,ts:i}]}},{key:"_formatReportData",value:function(e,t){var n={category:this._PERF_CATEGORY,logs:t,env:{}};return y(g(e),function(t){n.env[t]=e[t]}),[n]}},{key:"_random",value:function(){return Math.round(2147483647*Math.random())}},{key:"_isSampleHit",value:function(){return this._visitCode%1e4<100*this.trackerConfig.sampleRate}}],[{key:"addPlugin",value:function(t,e){if(!l(e.data))throw new Error("Can't add plugin ".concat(t,". The plugin object of data props should be")+" a function, but its type is ".concat(a(e.data)));u.plugins[t]=e}}]),u}();o(O,"plugins",{});var S,T=function(t){var e=window[t];if(l(e)&&!(e.q&&e.q.isInitialized&&e.q.initialized())){var n=new O,i=e?e.q:[];e.q=n,p(i)&&n.execute.apply(n,i)}};S=function(){if(window.MeituanAnalyticsObject){var t=window.MeituanAnalyticsObject;"[object String]"===Object.prototype.toString.call(t)&&(t=[t]);for(var e=0;e<t.length;e++)T(t[e])}},"complete"===document.readyState?S():b.addEvent("load",S)}();