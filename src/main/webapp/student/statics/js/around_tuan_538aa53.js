define("list:widget/around_tuan/around_tuan.js",function(t,a,e){function n(t){i(),p=t;var a=f.get("USUAL_ADDRESS")||f.get("HOME_ADDRESS")||f.get("COMPANY_ADDRESS"),e=f.get("USUAL_ADDRESS_INFO")||f.get("HOME_ADDRESS_INFO")||f.get("COMPANY_ADDRESS_INFO");if(a){var n=e.split(",");g(a,n[0],n[1])}else r();o()}function i(){m=new S({main:$("#dealsPager"),page:1,first:1,total:1,showCount:10,padding:0,showAlways:!1,lang:{firstPage:"首页",prev:"<em></em>",next:"<em></em>"}}),m.render()}function o(){$("#around-tuan-main").on("click",".ajax-get-deals",function(){var t=$(this),a=t[0].getAttribute("data-address"),e=t[0].getAttribute("data-lat"),n=t[0].getAttribute("data-lng");g(a,e,n)}),$("#around-tuan-main").on("click","#addressModify",function(){var t=$(this)[0].getAttribute("data-i");f.set("MODIFIED_TYPE",t),r()}),$("#around-tuan-main").on("click","#addressAdd",function(){r()}),$("#around-tuan-main").on("click",".address-set",function(){var t=$(this),a=t.parent()[0].getAttribute("data-lat"),e=t.parent()[0].getAttribute("data-lng"),n=t.parent()[0].getAttribute("data-address"),i=t[0].getAttribute("data-i");d(a,e,n,i)}),$("#around-tuan-main").on("click",".address-delete",function(){var t=$(this),a=t.parent()[0].getAttribute("data-lat"),e=t.parent()[0].getAttribute("data-lng"),n=t.parent()[0].getAttribute("data-address"),i=t[0].getAttribute("data-i"),o={name:"新位置",address:n,lat:a,lng:e};u(i,o)}),$("#around-tuan-main").on("click",".category-item",function(){var t=$(this)[0].getAttribute("data-i");v.categoryId!==t&&(v.categoryId=t,v.page=1,c())}),$("#around-tuan-main").on("click",".sort-type",function(){var t=$(this)[0].getAttribute("data-i");v.sortType!==t&&(v.sortType=$(this)[0].getAttribute("data-i"),v.page=1,c())}),$("#around-tuan-main").on("click","#appointment",function(){v.appoinment=v.appoinment?0:1,v.page=1,c()}),$("#around-tuan-main").on("click","#voucher",function(){v.voucher=v.voucher?0:1,v.page=1,c()}),$("#around-tuan-main").on("click","#quanwangdijia",function(){v.quanwangdijia=v.quanwangdijia?0:1,v.page=1,c()}),$("#around-tuan-main").on("click","#jingxuanpinpai",function(){v.jingxuanpinpai=v.jingxuanpinpai?0:1,v.page=1,c()}),$("#dealsPager").on("click","a",function(){v.page=parseInt($(this)[0].getAttribute("data-page"),10);var t=v.page;m.total>m.showCount&&(t>m.showCount/2+1?$(".n-pager-prev").next().addClass("n-pager-disabled"):$(".n-pager-prev").next().removeClass("n-pager-disabled")),c(!0),$("html, body").animate({scrollTop:$("#around-item-list").offset().top},1e3)}),$("#around-tuan-main").on("click",".prev-btn",function(){v.page>1&&(v.page=v.page-1,m.setPage(v.page),c(!0))}),$("#around-tuan-main").on("click",".next-btn",function(){$(this).hasClass("next-disable")||(v.page=v.page+1,m.setPage(v.page),c(!0))});var t=$("#hover-overlay");$("#around-tuan-main").on("mouseenter",".j-card",function(){var a=$(this),e=a.offset();t.css({left:e.left-5,top:e.top-5,visibility:"visible"})}).on("mouseleave",".j-card",function(){t.css({visibility:"hidden"})})}function r(){m.setTotal(0);var t=D("around-tuan-tpl",{});$("#around-tuan-main").html(t),new A(p),$(document.body)[0].setAttribute("mon","page=position_map")}function s(t){t=parseInt(t,10);var a={};switch(t){case 0:a.name="USUAL_ADDRESS",a.info="USUAL_ADDRESS_INFO";break;case 1:a.name="HOME_ADDRESS",a.info="HOME_ADDRESS_INFO";break;case 2:a.name="COMPANY_ADDRESS",a.info="COMPANY_ADDRESS_INFO"}return a}function d(t,a,e,n){var i=s(n);f.set(i.name,e),f.set(i.info,t+","+a),$("#position").html(l(n))}function u(t,a){var e=s(t);f.remove(e.name),f.remove(e.info),$("#position").html(l(3,a))}function l(t,a){var e,n=[],i=f.get("USUAL_ADDRESS"),o=f.get("HOME_ADDRESS"),r=f.get("COMPANY_ADDRESS");i&&(e=f.get("USUAL_ADDRESS_INFO").split(","),n[0]={name:"常去",address:i,lat:e[0],lng:e[1]}),o&&(e=f.get("HOME_ADDRESS_INFO").split(","),n[1]={name:"我家",address:o,lat:e[0],lng:e[1]}),r&&(e=f.get("COMPANY_ADDRESS_INFO").split(","),n[2]={name:"公司",address:r,lat:e[0],lng:e[1]}),a&&(n[3]=a);var s=D("position-tpl",{savedAddress:n,addressType:t});return s}function c(t){t||m.setTotal(0),$.ajax({type:"get",url:"/pcindex/main/positionsearch",dataType:"html",data:v,beforeSend:function(){var a='<div class="loading">数据加载中……</div>';$("#around-item-list").html(a),t||m.setTotal(0)},success:function(a){a&&($("#around-item-list").html(a),t||m.setTotal(Math.ceil(parseInt($("#totalDeals").html(),10)/20)))}})}function g(t,a,e){if(m&&m.setTotal(0),f.get("MODIFIED_TYPE")){var n=parseInt(f.get("MODIFIED_TYPE"),10);if(3!==n){var i=s(n);f.set(i.name,t),f.set(i.info,a+","+e),f.remove("MODIFIED_TYPE")}}v.lat=a,v.lng=e;var o=new BMap.Point(e,a),r=new BMap.Geocoder;r.getLocation(o,function(n){var i=n.addressComponents.city;v.cityName=i;var o=3;if(t===f.get("USUAL_ADDRESS")?o=0:t===f.get("HOME_ADDRESS")?o=1:t===f.get("COMPANY_ADDRESS")&&(o=2),3===o)var r={name:"新位置",address:t,lat:a,lng:e};var s=l(o,r),d=D("ajax-tuan-detail-tpl",{});$("#around-tuan-main").html(d),$("#position").html(s),v.page=1,$.ajax({type:"get",url:"/pcindex/main/positionsearch",dataType:"html",data:v,beforeSend:function(){var t='<div class="loading">数据加载中……</div>';$("#around-item-list").html(t),m.setTotal(0)},success:function(t){t&&($("#around-item-list").html(t),m.setTotal(Math.ceil(parseInt($("#totalDeals").html(),10)/20)),$(document.body)[0].setAttribute("mon","page=position_search_list"))}})})}var p,m,A=t("list:widget/around_tuan/around_tuan_map.js"),f=t("common:widget/ui/cookie/cookie.js"),D=t("common:widget/ui/template/template.js").template,S=t("common:widget/dep/moye/Pager.js"),v={lat:0,lng:0,cityName:"",categoryId:326,sortType:1,appoinment:0,voucher:0,quanwangdijia:0,jingxuanpinpai:0,page:1};e.exports={init:n}});